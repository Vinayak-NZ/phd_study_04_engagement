NA,
ifelse(app_v1_v2_baseline_01$Familie_Sch_IG < 0 &
app_v1_v2_baseline_01$dupl1_Familie_Sch_IG > 0,
app_v1_v2_baseline_01$dupl1_Familie_Sch_IG,
app_v1_v2_baseline_01$Familie_Sch_IG))
app_v1_v2_baseline_01$OE <- ifelse(app_v1_v2_baseline_01$OE2_Sch_IG < 0 &
app_v1_v2_baseline_01$OE2_Schw_KG< 0,
NA,
ifelse(app_v1_v2_baseline_01$OE2_Sch_IG < 0 &
app_v1_v2_baseline_01$OE2_Schw_KG > 0,
app_v1_v2_baseline_01$OE2_Schw_KG,
app_v1_v2_baseline_01$OE2_Sch_IG))
app_v1_v2_baseline_01$CSE <- ifelse(app_v1_v2_baseline_01$CSE2_Sch_IG < 0 &
app_v1_v2_baseline_01$CSE2_Schw_KG< 0,
NA,
ifelse(app_v1_v2_baseline_01$CSE2_Sch_IG < 0 &
app_v1_v2_baseline_01$CSE2_Schw_KG > 0,
app_v1_v2_baseline_01$CSE2_Schw_KG,
app_v1_v2_baseline_01$CSE2_Sch_IG))
app_v1_v2_baseline_01$INT <- ifelse(app_v1_v2_baseline_01$Int_Sch_IG < 0 &
app_v1_v2_baseline_01$INT_Schw_KG < 0,
NA,
ifelse(app_v1_v2_baseline_01$Int_Sch_IG < 0 &
app_v1_v2_baseline_01$INT_Schw_KG > 0,
app_v1_v2_baseline_01$INT_Schw_KG,
app_v1_v2_baseline_01$Int_Sch_IG))
app_v1_v2_baseline_01$PL <- ifelse(app_v1_v2_baseline_01$PL_Sch_IG < 0 &
app_v1_v2_baseline_01$PL_Schw_KG < 0,
NA,
ifelse(app_v1_v2_baseline_01$PL_Sch_IG < 0 &
app_v1_v2_baseline_01$PL_Schw_KG > 0,
app_v1_v2_baseline_01$PL_Schw_KG,
app_v1_v2_baseline_01$PL_Sch_IG))
app_v1_v2_baseline_01$VUEIC1 <- ifelse(app_v1_v2_baseline_01$VUEIC1_Sch_IG < 0 &
app_v1_v2_baseline_01$VUEIC1_Sch_KG < 0,
NA,
ifelse(app_v1_v2_baseline_01$VUEIC1_Sch_IG < 0 &
app_v1_v2_baseline_01$VUEIC1_Sch_KG > 0,
app_v1_v2_baseline_01$VUEIC1_Sch_KG,
app_v1_v2_baseline_01$VUEIC1_Sch_IG))
app_v1_v2_baseline_01$VUEIC2 <- ifelse(app_v1_v2_baseline_01$VUEIC2_Sch_IG < 0 &
app_v1_v2_baseline_01$VUEIC2_Sch_KG < 0,
NA,
ifelse(app_v1_v2_baseline_01$VUEIC2_Sch_IG < 0 &
app_v1_v2_baseline_01$VUEIC2_Sch_KG > 0,
app_v1_v2_baseline_01$VUEIC2_Sch_KG,
app_v1_v2_baseline_01$VUEIC2_Sch_IG))
app_v2_baseline_01 <-
app_v1_v2_baseline_01[as.Date(app_v1_v2_baseline_01$datetime) >
as.Date('2022-07-31'), ]
app_v2_baseline_dem_01 <-
app_v2_baseline_01[, c("UserCode",
"alter",
"ausbildung",
"familie",
"OE",
"CSE",
"INT",
"PL",
"VUEIC1",
"VUEIC2")]
# v2-baseline-data-02
app_v2_baseline_02 <-
app_v2_baseline_02[app_v2_baseline_02$Gruppe_Allgemein == 1, ]
usercode_vars_02 <-
app_v2_baseline_02[, grep("Code",
names(app_v2_baseline_02), value = TRUE)]
age_vars_03 <-
app_v2_baseline_02[, grep("Alter",
names(app_v2_baseline_02), value = TRUE)]
education_vars_02 <-
app_v2_baseline_02[, grep("Ausbildung",
names(app_v2_baseline_02), value = TRUE)]
family_vars_02 <-
app_v2_baseline_02[, grep("Familie",
names(app_v2_baseline_02), value = TRUE)]
oe_vars_02 <-
app_v2_baseline_02[, grep("OE",
names(app_v2_baseline_02), value = TRUE)]
cse_vars_02 <-
app_v2_baseline_02[, grep("CSE",
names(app_v2_baseline_02), value = TRUE)]
int_vars_02<-
app_v2_baseline_02[, grep("Int|INT",
names(app_v2_baseline_02), value = TRUE)]
pl_vars_02 <-
app_v2_baseline_02[, grep("PL",
names(app_v2_baseline_02), value = TRUE)]
vueic1_vars_02 <-
app_v2_baseline_02[, grep("VUEIC1",
names(app_v2_baseline_02), value = TRUE)]
vueic2_vars_02 <-
app_v2_baseline_02[, grep("VUEIC2",
names(app_v2_baseline_02), value = TRUE)]
app_v2_baseline_02$UserCode <- app_v2_baseline_02$UserCode_4_Sch_IG
app_v2_baseline_02$UserCode <- toupper(app_v2_baseline_02$UserCode)
app_v2_baseline_02$alter <- app_v2_baseline_02$Alter_Sch_IG
app_v2_baseline_02$ausbildung <- app_v2_baseline_02$Ausbildung_Sch_IG
app_v2_baseline_02$familie <- app_v2_baseline_02$Familie_Sch_IG
app_v2_baseline_02$OE <- app_v2_baseline_02$OE2_Sch_IG
app_v2_baseline_02$CSE <- app_v2_baseline_02$CSE2_Sch_IG
app_v2_baseline_02$INT <- app_v2_baseline_02$Int_Sch_IG
app_v2_baseline_02$PL <- app_v2_baseline_02$PL_Sch_IG
app_v2_baseline_02$VUEIC1 <- app_v2_baseline_02$VUEIC1_Sch_IG
app_v2_baseline_02$VUEIC2 <- app_v2_baseline_02$VUEIC2_Sch_IG
app_v2_baseline_dem_02 <-
app_v2_baseline_02[, c("UserCode",
"alter",
"ausbildung",
"familie",
"OE",
"CSE",
"INT",
"PL",
"VUEIC1",
"VUEIC2")]
# v2-baseline-data-03
app_v2_baseline_03 <-
app_v2_baseline_03[app_v2_baseline_03$Gruppe_Allgemein == 1, ]
usercode_vars_03 <-
app_v2_baseline_03[, grep("Code",
names(app_v2_baseline_03), value = TRUE)]
age_vars_03 <-
app_v2_baseline_03[, grep("Alter",
names(app_v2_baseline_03), value = TRUE)]
education_vars_03 <-
app_v2_baseline_03[, grep("Ausbildung",
names(app_v2_baseline_03), value = TRUE)]
family_vars_03 <-
app_v2_baseline_03[, grep("Familie",
names(app_v2_baseline_03), value = TRUE)]
oe_vars_03 <-
app_v2_baseline_03[, grep("OE",
names(app_v2_baseline_03), value = TRUE)]
cse_vars_03 <-
app_v2_baseline_03[, grep("CSE",
names(app_v2_baseline_03), value = TRUE)]
int_vars_03 <-
app_v2_baseline_03[, grep("Int|INT",
names(app_v2_baseline_03), value = TRUE)]
pl_vars_03 <-
app_v2_baseline_03[, grep("PL",
names(app_v2_baseline_03), value = TRUE)]
vueic1_vars_03 <-
app_v2_baseline_03[, grep("VUEIC1",
names(app_v2_baseline_03), value = TRUE)]
vueic2_vars_03 <-
app_v2_baseline_03[, grep("VUEIC2",
names(app_v2_baseline_03), value = TRUE)]
app_v2_baseline_03$UserCode <- app_v2_baseline_03$UserCode_4_Sch_IG
app_v2_baseline_03$UserCode <- toupper(app_v2_baseline_03$UserCode)
app_v2_baseline_03$alter <- app_v2_baseline_03$Alter_Sch_IG
app_v2_baseline_03$ausbildung <- app_v2_baseline_03$Ausbildung_Sch_IG
app_v2_baseline_03$familie <- app_v2_baseline_03$Familie_Sch_IG
app_v2_baseline_03$OE <- app_v2_baseline_03$OE2_Sch_IG
app_v2_baseline_03$CSE <- app_v2_baseline_03$CSE2_Sch_IG
app_v2_baseline_03$INT <- app_v2_baseline_03$Int_Sch_IG
app_v2_baseline_03$PL <- app_v2_baseline_03$PL_Sch_IG
app_v2_baseline_03$VUEIC1 <- app_v2_baseline_03$VUEIC1_Sch_IG
app_v2_baseline_03$VUEIC2 <- app_v2_baseline_03$VUEIC2_Sch_IG
app_v2_baseline_dem_03 <-
app_v2_baseline_03[, c("UserCode",
"alter",
"ausbildung",
"familie",
"OE",
"CSE",
"INT",
"PL",
"VUEIC1",
"VUEIC2")]
app_v2_baseline <- rbind(app_v2_baseline_dem_01,
app_v2_baseline_dem_02,
app_v2_baseline_dem_03)
app_v2_baseline$alter <- ifelse(app_v2_baseline$alter < 0,
NA,
app_v2_baseline$alter)
app_v2_baseline$ausbildung <- ifelse(app_v2_baseline$ausbildung < 0,
NA,
app_v2_baseline$ausbildung)
app_v2_baseline$familie <- ifelse(app_v2_baseline$familie < 0,
NA,
app_v2_baseline$familie)
app_v2_baseline$OE <- ifelse(app_v2_baseline$OE < 0,
NA,
app_v2_baseline$OE)
app_v2_baseline$CSE <- ifelse(app_v2_baseline$CSE < 0,
NA,
app_v2_baseline$CSE)
app_v2_baseline$INT <- ifelse(app_v2_baseline$INT < 0,
NA,
app_v2_baseline$INT)
app_v2_baseline$PL <- ifelse(app_v2_baseline$PL < 0,
NA,
app_v2_baseline$PL)
app_v2_baseline$VUEIC1 <- ifelse(app_v2_baseline$VUEIC1 < 0,
NA,
app_v2_baseline$VUEIC1)
app_v2_baseline$VUEIC2 <- ifelse(app_v2_baseline$VUEIC2 < 0,
NA,
app_v2_baseline$VUEIC2)
source("R/02_format_baseline.R")
View(app_v2_baseline_subset)
app_v1_clinic_exclusions <- merge(app_v1_passive_data,
app_v1_clinic,
by = "UserCode",
all.x = TRUE)
app_v1_clinic_exclusions <- app_v1_clinic_exclusions[
!(app_v1_clinic_exclusions$clinic %in% c("Frankfurt", "Ulm")), ]
app_v1_clinic_exclusions <- app_v1_clinic_exclusions[,
!names(app_v1_clinic_exclusions) == "clinic"]
app_v1_all_aux <- merge(app_v1_item_page_match,
app_v1_page_count,
by = "page_id",
all.x = TRUE)
app_v1_passive_data_clean <- merge(app_v1_clinic_exclusions,
app_v1_all_aux,
by = "codename_id",
all.x = TRUE)
app_v2_all_aux <- merge(app_v2_item_page_match,
app_v2_page_count,
by = "page_id",
all.x = TRUE)
app_v2_passive_data_clean <- merge(app_v2_passive_data,
app_v2_all_aux,
by = "codename_id",
all.x = TRUE)
app_v1_active_data_clean <- merge(app_v1_hapa_clean,
app_v1_safety_clean,
by = "id")
app_v2_active_data_clean <- merge(app_v2_hapa_clean,
app_v2_safety_clean,
by = "id")
app_v1_feedback_added <- merge(app_v1_active_data_clean,
app_v1_feedback,
by = "id")
app_v2_feedback_added <- merge(app_v2_active_data_clean,
app_v2_feedback,
by = "id")
app_v1_complete_data <- merge(app_v1_passive_data_clean,
app_v1_feedback_added,
by = "id")
app_v2_complete_data <- merge(app_v2_passive_data_clean,
app_v2_feedback_added,
by = "id")
app_v1_complete_data <- merge(app_v1_complete_data,
app_v1_baseline_subset,
by = "id",
all.x = TRUE)
app_v2_complete_data <- merge(app_v2_complete_data,
app_v2_baseline_subset,
by = "UserCode",
all.x = TRUE)
View(app_v2_complete_data)
app_v1_key <-
app_v1_complete_data[,
c("id",
"version",
"UserCode",
"Timestamp",
"pages_completed",
"lessons_completed",
"open_ended_item",
"item_response",
"hapa1_t1",
"hapa2_t1",
"hapa3_t1",
"hapa4_t1",
"hapa5_t1",
"safe1_t1",
"safe2_t1",
"hapa2_t0",
"hapa3_t0",
"hapa4_t0",
"hapa5_t0",
"safe1_t0",
"safe2_t0",
"ux",
"content",
"utility")]
app_v2_key <-
app_v2_complete_data[,
c("id",
"version",
"UserCode",
"Timestamp",
"pages_completed",
"lessons_completed",
"open_ended_item",
"item_response",
"hapa1_t1",
"hapa2_t1",
"hapa3_t1",
"hapa4_t1",
"hapa5_t1",
"safe1_t1",
"safe2_t1",
"hapa2_t0",
"hapa3_t0",
"hapa4_t0",
"hapa5_t0",
"safe1_t0",
"safe2_t0",
"ux",
"content",
"utility")]
app_key_vars <- rbind(app_v1_key, app_v2_key)
## ---- remove-test-cases
app_key_vars_valid <- app_key_vars[
!(grepl("TEST", app_key_vars$UserCode, fixed = TRUE)),
]
app_key_vars_valid$time_stamp <- as.POSIXct(app_key_vars_valid$Timestamp,
format = "%Y-%m-%dT%H:%M%OS"
)
setDT(app_key_vars_valid)
app_key_vars_valid <- app_key_vars_valid[order(version, id, time_stamp), ]
app_key_vars_valid[,
diff := as.numeric(time_stamp - shift(time_stamp)),
by = c("version", "id")
]
app_key_vars_valid$log_in_marker <- ifelse(is.na(app_key_vars_valid$diff),
1,
ifelse(app_key_vars_valid$diff > 1800,
1,
0
)
)
app_key_vars_valid[,
total_log_in := sum(log_in_marker),
by = c("version", "id")]
## ---- create-log-in-count
unique_log_in <- app_key_vars_valid[
app_key_vars_valid$log_in_marker == 1,
c("version", "id", "time_stamp", "log_in_marker")
]
unique_log_in[,
log_in_count := cumsum(log_in_marker),
by = c("version", "id")]
unique_log_in <- unique_log_in[, c("version",
"id",
"time_stamp",
"log_in_count")]
app_key_vars_valid <- as.data.frame(app_key_vars_valid)
unique_log_in <- as.data.frame(unique_log_in)
app_key_vars_log_ins <- merge(app_key_vars_valid,
unique_log_in,
by = c("version",
"id",
"time_stamp"), all.x = TRUE
)
setDT(app_key_vars_log_ins)
app_key_vars_log_ins <- app_key_vars_log_ins[order(version,
id,
time_stamp), ]
app_key_vars_log_ins <- app_key_vars_log_ins %>%
dplyr::group_by(version, id) %>%
fill(log_in_count)
## ---- create-time-per-visit
time_visit <- app_key_vars_log_ins %>%
group_by(version, id, log_in_count) %>%
summarise(
First = first(time_stamp),
Last = last(time_stamp),
time_spent_visit = difftime(last(time_stamp),
first(time_stamp),
unit = "mins"
)
)
time_visit <- time_visit[, c(
"version",
"id",
"log_in_count",
"time_spent_visit"
)]
app_key_vars_time <- merge(app_key_vars_log_ins,
time_visit,
by = c("version", "id", "log_in_count"),
all.x = TRUE
)
days_between <- app_key_vars_log_ins %>%
group_by(version, id) %>%
summarise(
First = first(time_stamp),
Last = last(time_stamp),
days_between = difftime(last(time_stamp), first(time_stamp), unit = "days")
)
days_between$days_between <- round(days_between$days_between, digits = 0)
days_between <- days_between[, c("version", "id", "days_between")]
final_data <- merge(app_key_vars_time, days_between,
by = c("version", "id"), all.x = TRUE
)
final_data_key_vars <- final_data[, c("id",
"version",
"UserCode",
"log_in_count",
"pages_completed",
"lessons_completed",
"open_ended_item",
"total_log_in",
"time_spent_visit",
"days_between",
"item_response",
"hapa2_t0",
"hapa3_t0",
"hapa4_t0",
"hapa5_t0",
"safe1_t0",
"safe2_t0",
"hapa1_t1",
"hapa2_t1",
"hapa3_t1",
"hapa4_t1",
"hapa5_t1",
"safe1_t1",
"safe2_t1",
"ux",
"content",
"utility")]
setDT(final_data_key_vars)
final_data_key_vars[,
pages_viewed := max(pages_completed, na.rm = TRUE),
by = c("version", "id")]
final_data_key_vars$proportion_pages_viewed <- ifelse(final_data_key_vars$version == "Version 1",
(final_data_key_vars$pages_viewed/141)*100,
(final_data_key_vars$pages_viewed/112)*100)
final_data_key_vars[,
lessons_viewed := max(lessons_completed, na.rm = TRUE),
by = c("version", "id")]
## ---- open_ended_items
final_data_key_vars$open_ended_items_completed <-
ifelse(final_data_key_vars$open_ended_item == 0 | is.na(final_data_key_vars$item_response), 0,
ifelse(
final_data_key_vars$open_ended_item == 1 &
nchar(final_data_key_vars$item_response) > 10, 1, 0)
)
final_data_key_vars[,
items_available := sum(open_ended_item, na.rm = TRUE),
by = c("version", "id")]
final_data_key_vars[,
total_open_items := sum(open_ended_items_completed, na.rm = TRUE),
by = c("version", "id")]
final_data_key_vars$proportion_items_completed <-
ifelse(final_data_key_vars$items_available == 0, 0,
ifelse(final_data_key_vars$version == "Version 1",
(final_data_key_vars$total_open_items/final_data_key_vars$items_available)*100,
(final_data_key_vars$total_open_items/final_data_key_vars$items_available)*100))
final_data_key_vars$action_plan <-
ifelse(final_data_key_vars$lessons_viewed > 8, 1, 0)
final_data_key_vars[,
average_time_spent := mean(time_spent_visit),
by = c("version", "id")]
unique_cases <-
distinct(final_data_key_vars, version, id, .keep_all = TRUE)
unique_cases$progress_score <-
(unique_cases$lessons_completed*10)*0.5 +
(unique_cases$proportion_pages_viewed*0.3) +
(unique_cases$proportion_items_completed*0.2)
unique_cases_subset <-
unique_cases[, c("version", "id", "progress_score")]
final_data_all_vars <- merge(final_data_key_vars,
unique_cases_subset,
by = c("version", "id"))
unique_cases <-
distinct(final_data_all_vars, version, id, .keep_all = TRUE)
unique_cases <-
as.data.frame(unique_cases)
variables_impute <- c("hapa2_t0",
"hapa3_t0",
"hapa4_t0",
"hapa5_t0",
"hapa1_t1",
"hapa2_t1")
remainder <- unique_cases[, !(names(unique_cases) %in% variables_impute)]
to_impute <- unique_cases[, c("version",
"id",
variables_impute)]
init <- mice(to_impute, maxit = 0)
meth <- init$method
predM <- as.matrix(init$predictorMatrix)
predM[, "version"] <- 0
predM[, "id"] <- 0
predM[, "hapa1_t1"] <- 0
predM[, "hapa2_t1"] <- 0
meth[c("version", "id", "hapa2_t0", "hapa3_t0", "hapa4_t0", "hapa5_t0")] = ""
imputed <- mice(to_impute,
method=meth,
predictorMatrix=predM,
m=5,
print = FALSE)
#long <- complete(imputed, action = 'long', include = TRUE)
imputed <- complete(imputed)
post_imputed <- merge(remainder, imputed, by = c("version", "id"))
View(post_imputed)
## ---- prep-data
source("R/00_load_data.R")
source("R/00_load_functions.R")
source("R/00_load_package.R")
source("R/01_format_active_data.R")
source("R/01_format_passive_data.R")
source("R/02_format_active_data_feedback.R")
source("R/02_format_active_data_hapa.R")
source("R/02_format_active_data_safety.R")
source("R/02_format_app_v2_baseline.R")
source("R/02_format_baseline_all.R")
source("R/02_join_data.R")
source("R/03_prepare_data.R")
source("R/04_derive_variables.R")
source("R/04_process_app_use_data.R")
source("R/04_process_sentiment_data.R")
source("R/06_model_engagement.R")
model_summary
model_2
